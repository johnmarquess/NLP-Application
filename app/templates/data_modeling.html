{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <h2>Data Modeling</h2>
        <div class="row">
            <!-- Load a spaCy Model -->
            <div class="col-md-6">
                <h3>Load a spaCy Model</h3>
                <p> You need to have downloaded spaCy models first</p>
                <form method="post">
                    {{ spacy_model_form.csrf_token }}
                    {% for model in spacy_model_form.model %}
                        <div class="form-check">
                            {{ model(class="form-check-input") }}
                            {{ model.label(class="form-label") }}
                        </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-outline-primary btn-sm">Load Model</button>
                </form>
            </div>


            <!-- Preprocess Data -->
            <div class="col-md-6">
                <h3>Preprocess Data</h3>

                <form method="POST">

                    {{ preprocessing_form.hidden_tag() }}
                    <div class="form-group">
                        <div class="mb-3">
                            {{ preprocessing_form.file.label(class="form-label") }}
                            {{ preprocessing_form.file(id='file-select', class="form-select") }}
                        </div>
                        <div>
                            {{ preprocessing_form.column_to_preprocess.label(class="form-label") }}
                            <select id="column-select" name="column_to_preprocess" class="form-select">
                                <!-- This will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="row mt-lg-2">
                            <p>Select which  preprocessing functions you would like to perform</p>
                            <div class="col-md-6">
                                <!-- Display checkboxes for preprocessing options -->
                                <div>{{ preprocessing_form.lemmatize(class="form-check-input") }} Lemmatize</div>
                                <div>{{ preprocessing_form.lowercase(class="form-check-input") }} Make Lowercase</div>
                                <div>{{ preprocessing_form.remove_stopwords(class="form-check-input") }} Remove English
                                    Stop
                                    Words
                                </div>
                                <div>{{ preprocessing_form.remove_punctuation(class="form-check-input") }} Remove
                                    Punctuation
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div>{{ preprocessing_form.remove_spaces(class="form-check-input") }} Remove Spaces
                                </div>
                                <!-- Field for renaming the data column -->
                                <div> {{ preprocessing_form.remove_newlines(class="form-check-input") }} Remove
                                    Newlines
                                </div>
                                <div> {{ preprocessing_form.remove_special_chars(class="form-check-input") }} Remove
                                    Special Characters
                                </div>
                            </div>

                        </div>
                        <!-- Options for storing the preprocessed data -->
                        <div>{{ preprocessing_form.store_as.label(class="form-label") }}
                            {{ preprocessing_form.store_as(class = "form-select") }}
                        </div>
                        <div>{{ preprocessing_form.submit(class="btn btn-outline-primary btn-sm)") }}</div>
                    </div>
                </form>

            </div>
        </div>

        <div class="row">
            <!-- Run a Model -->
            <div class="col-md-6">
                <h3>Run a Model</h3>
                <!-- Placeholder for running a model form -->
            </div>

            <!-- View Model Outputs -->
            <div class="col-md-6">
                <h3>View Model Outputs</h3>
                <!-- Placeholder for model outputs -->

            </div>
        </div>
        {% if processed_data_head %}
            <h3>Processed Data Preview</h3>
            <div>
                {{ processed_data_head|safe }}  <!-- 'safe' filter to render HTML -->
            </div>
        {% endif %}
    </div>


    <script type="text/javascript">
        document.getElementById('file-select').addEventListener('change', function () {
            const fileName = this.value;
            fetch(`/get-columns?file=${encodeURIComponent(fileName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.columns) {
                        updateColumnDropdown(data.columns);
                    }
                });
        });

        function updateColumnDropdown(columns) {
            const columnSelect = document.getElementById('column-select');
            columnSelect.innerHTML = ''; // Clear existing options
            columns.forEach(column => {
                const option = document.createElement('option');
                option.value = column;
                option.textContent = column;
                columnSelect.appendChild(option);
            });
        }


    </script>




{% endblock %}
