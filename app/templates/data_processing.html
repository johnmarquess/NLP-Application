<!-- data_processing.html -->
{% extends 'base.html' %}
{% block content %}
    <div class="container mt-lg-5">
    <h2 class="mb-lg-5">Data pre-processing</h2>
    <div class="row">
        <div class="col-md-6">
            <form method="post" class="mb-3">
                {{ model_form.hidden_tag() }}
                {{ model_form.model(class="form-select", id="model-select") }}
                <input type="submit" name="model_submit" value="Select Model"
                       class="btn btn-outline-primary btn-sm mb-4">
            </form>

            <form method="post">
                {{ preprocess_form.hidden_tag() }}
                <div class="mb-3">
                    <label class="form-label"><h5>File and Preprocessing Options</h5></label>
                    {{ preprocess_form.file(class="form-select", id="file-select") }}
                </div>
                <div class="mb-3">
                    {{ preprocess_form.column_to_preprocess(class="form-select", id="column-select") }}
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            {{ preprocess_form.lemmatize(class="form-check-input", id="lemmatize") }}
                            <label for="lemmatize" class="form-check-label">Lemmatize</label>
                        </div>
                        <div class="form-check">
                            {{ preprocess_form.remove_stopwords(class="form-check-input", id="remove-stopwords") }}
                            <label for="remove-stopwords" class="form-check-label">Remove Stopwords</label>
                        </div>
                        <div class="form-check">
                            {{ preprocess_form.lowercase(class="form-check-input", id="lowercase") }}
                            <label for="lowercase" class="form-check-label">Make lowercase</label>
                        </div>
                        <div class="form-check">
                            {{ preprocess_form.remove_punctuation(class="form-check-input", id="remove-punctuation") }}
                            <label for="remove-punctuation" class="form-check-label">Remove Punctuation</label>
                        </div>
                    </div>
                    <!-- Second Column -->
                    <div class="col-md-6">
                        <div class="form-check">
                            {{ preprocess_form.remove_spaces(class="form-check-input", id="remove-spaces") }}
                            <label for="remove-spaces" class="form-check-label">Remove Spaces</label>
                        </div>
                        <div class="form-check">
                            {{ preprocess_form.remove_special_chars(class="form-check-input", id="remove_special_chars") }}
                            <label for="remove_special_chars" class="form-check-label">Remove Special
                                Characters</label>
                        </div>
                        <div class="form-check">
                            {{ preprocess_form.remove_newlines(class="form-check-input", id="remove_newlines") }}
                            <label for="remove_newlines" class="form-check-label">Remove Newlines</label>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="store-as" class="form-label">Store As</label>
                    {{ preprocess_form.store_as(class="form-select", id="store-as") }}
                </div>
                <div class="mb-3">
                    {{ preprocess_form.output_filename(class="form-control", placeholder="Output filename") }}
                </div>
                <form method="post">
                    <input type="submit" name="process_submit" value="Process Data"
                           class="btn btn-outline-primary btn-sm">
                </form>
            </form>
        </div>


        <div class="col-md-6">
            <h3>Pre-processing and model settings summary</h3>
            <p>This displays when you pre-process the file</p>
            {% if summary %}
                <table class="table">
                    <tr>
                        <th>Feature</th>
                        <th>Value</th>
                    </tr>
                    {% for key, value in summary.items() %}
                        <tr>
                            <td>{{ key }}</td>
                            <td>{{ value }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
    </div>



    <div class="row">
        <div class="col-md-12 table-noto">
            {% if processed_data_head %}
                <div>
                    {{ processed_data_head | safe }}
                </div>
            {% endif %}
        </div>


    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var fileSelect = document.getElementById('file-select');
            var columnSelect = document.getElementById('column-select');

            fileSelect.addEventListener('change', function () {
                var filename = this.value;
                if (filename) {
                    fetch('{{ url_for("data_processor.get_columns", filename="") }}' + filename)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert('Error: ' + data.error);
                            } else {
                                columnSelect.innerHTML = '';
                                data.forEach(function (column) {
                                    var option = new Option(column, column);
                                    columnSelect.add(option);
                                });
                            }
                        }).catch(error => console.error('Fetch Error:', error));
                }
            });
        });
    </script>



{% endblock %}

